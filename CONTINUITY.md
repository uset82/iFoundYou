# Continuity Ledger

- Goal (incl. success criteria): Build a Loopt-like test web app (Netlify deploy) with OpenAI App SDK integration; add ability to send friend requests from phone/email contacts; extend the product plan for emergency/off-grid messaging and calling on iOS/Android; deploy a ChatGPT app with a working MCP server endpoint.
- Constraints/Assumptions: ASCII preferred; repo includes web app in `web/`; no tests yet; Windows path cannot include `http://` so `http://CONTINUITY.md` refers to `CONTINUITY.md`; user expects minimal questions and prefers the agent to run steps; user is on Windows with no Mac but has an Apple account.
- Key decisions: Proceed with default stack (Vite React, MapLibre, Supabase PostGIS, Netlify Functions); project name is "IfoundYou"; create Supabase schema file before wiring RLS; best path for offline mesh is a native companion app plus the web app for the ChatGPT store; choose React Native for the companion app to reuse React code and integrate native Bluetooth/Wi-Fi modules; choose `react-native-ble-plx` for BLE discovery and messaging; choose to build and deploy a new MCP server from this repo on a stable host for the ChatGPT app; choose Render for MCP hosting with no auth for the initial ChatGPT app; ngrok works for manual tests but is not reliable for ChatGPT connector due to warning/header requirements.
- State: Google OAuth added; email sign-up validates password length; Grok/X-style UI live with logo; adding community emergency alerts for disasters (water/food/medical/lost); user hit SQL error by pasting JS into SQL editor; user attempting Google provider setup in Supabase; Google OAuth client created (ID + secret) and needs to be added to Supabase; Google console error due to callback URL placed in Authorized JavaScript origins; Supabase SQL editor cannot alter `public.spatial_ref_sys` (ownership); Netlify site loads blank and likely missing Supabase envs; OAuth redirect is going to localhost:3000 and needs Supabase URL Configuration updated; contact-based friend request flow added (schema + RPC + UI); reported UI issue: nav buttons (Friends/Alerts/Discover/Settings) not clickable after sign in; attempted fix by isolating map panel stacking; reported iPhone layout messy, added tighter mobile styles and contact card fixes; Friends view simplified to a single invite/share card with Apple/Google/Facebook/Instagram suggestions and pushed to GitHub; new request: update emergency/off-grid messaging and calling plan based on research notes; ngrok tunnel active for MCP at `https://b7cef320d007.ngrok-free.app/mcp`; ngrok free URL shows a browser warning unless the client sends `ngrok-skip-browser-warning: true`; ChatGPT connector creation timed out; local MCP server required explicit Accept header for Streamable HTTP and responded as expected; user cannot access Render free tier and asked about Docker hosting; Docker Desktop now running; Docker image built successfully; container running on host port 3002; user reports UI style regression/unexpected layout in the web app; map + rail layout restored in `web/src/App.tsx` with rail content moved to a dedicated aside and the map kept visible; user ran `npm run dev` from repo root and hit ENOENT because `package.json` lives under `web/`; overlapping UI reported when selecting Mesh Network and fixed by hiding the map panel on emergency view and renaming EmergencyChat sidebar classes to avoid CSS collisions; changes committed and pushed to `origin/main` (commit `e9fb3fa`); Netlify CLI not installed (`netlify` not found); web-only chat implemented using Supabase messages + realtime subscriptions and wired to the Friends list (commit `b3a3f35`).
- Done: Read Loopt research files; delivered plan in `docs/plan.md`; scaffolded Vite app; converted to React; added MapLibre map and geolocation; updated map style/markers/controls; added Netlify config + health + location-update + nearby + discover + alerts + cleanup functions; added `.env.example`; added Supabase schema + RLS + triggers; added Supabase client + auth UI; wired location writes to Supabase with alerts call; added friend requests + pending lists; added friend markers + nearby list + notification prompts; added discoverable toggle + discovery list; added alerts inbox UI; added Google OAuth sign-in button and password length validation; updated `docs/supabase-setup.md`; added `supabase/.env.example`; added `docs/openai-tools.json` + `docs/openai-integration.md`; added `docs/deploy.md`; updated `AGENTS.md`; updated `netlify.toml` build command; set local `web/.env` and root `.env` with Supabase URL + anon key; made schema enum creation idempotent; fixed MapLibre null checks; `npm run build` succeeded; redesigned UI to Grok/X-inspired dark layout in `web/src/App.tsx` and `web/src/style.css`; added logo lockup in sidebar brand; added community alert schema, RLS, Netlify function, and UI; added README with setup + deploy steps; initialized git repo and pushed to GitHub; added safe Supabase client fallback for missing envs and pushed fix; added `profiles` contact email/phone fields + `match_contacts` RPC; added contact import/paste + settings UI and styles for contact-based friend requests; added map panel containment styles to avoid overlay issues; added mobile layout tightening for iPhone; moved contact-picker warning below button and added mobile layout tightening for buttons/text wrapping; simplified Friends view to a single invite/share card and added Apple/Google share options; added emergency-mode addendums to `messcomunication.md`, `iPhone Mesh Communication Research.md`, `Off-Grid Mesh Messaging_ Open-Source Projects & Technologies.md`, and `Offline Communication App Research.md`; created `docs/native-companion-plan.md` with the React Native offline mesh plan; scaffolded React Native app in `mobile/` (IfoundYouMobile) and removed the nested `.git`; added baseline mobile shell (tabs + screens), config stub, Supabase client stub, and `.env.example`; added `@supabase/supabase-js` to mobile dependencies; added `react-native-ble-plx` with BLE scan wiring, device list UI, and placeholder mesh queue; added BLE permissions to Android and Bluetooth usage strings to iOS Info.plist; added iOS Multipeer native module, JS wrapper, and P2P UI hooks; added iOS local network permissions and Bonjour service; updated Xcode project to include new native files; added Android Wi-Fi Direct native module and package, wired JS wrapper and Mesh screen controls, and updated Android manifest permissions; added EAS config (`mobile/app.config.js`, `mobile/eas.json`) and set iOS bundle identifier to `com.ifoundyoumobile`; added TestFlight guidance to `mobile/README.md`; added `mcp/` MCP server with tools and Render deployment docs; updated `render.yaml`, `.gitignore`, and added `mcp/.env.example`; committed and pushed MCP server changes to GitHub; started MCP server locally and opened ngrok tunnel `https://c91da1d75119.ngrok-free.app`; fixed MCP server imports to use `.js` paths for CommonJS runtime; updated root Dockerfile/.dockerignore and converted `proxy-server.js` to CommonJS for Docker setup; ran `npm run build` in `web/` successfully (Vite chunk size warning only); restored the right rail layout in `web/src/App.tsx` with a dedicated rail aside and a default Friends panel; fixed emergency chat overlap and pushed the full set of UI + MCP Docker helpers to GitHub.
- Now: Apply the new `messages` table + RLS in Supabase, enable Realtime for `messages`, and verify web chat between friends.
- Next: If the layout is confirmed, return to Supabase OAuth + Netlify env setup.
- Open questions (UNCONFIRMED if needed): Clarify what "upload into ChatGPT app" means (GPT, App SDK app, or share link); obtain Supabase service role key if you want scheduled cleanup on Netlify later; confirm `WEB_APP_URL` value to set on the MCP server; untracked `client_secret_*.json` and `image/` folders seen in repo - confirm whether to ignore or include (avoid pushing secrets); do you want to deploy via Docker (and if so, where: Fly/Railway/Koyeb/VPS)?; unexpected untracked `Dockerfile`, `.dockerignore`, and `proxy-server.js` in repo root - confirm whether to use, delete, or ignore.
- Working set (files/ids/commands): `AGENTS.md`, `CONTINUITY.md`, `README.md`, `docs/plan.md`, `docs/supabase-setup.md`, `docs/openai-tools.json`, `docs/openai-integration.md`, `docs/deploy.md`, `netlify.toml`, `.gitignore`, `netlify/functions/health.js`, `netlify/functions/location-update.js`, `netlify/functions/nearby.js`, `netlify/functions/discover.js`, `netlify/functions/alerts.js`, `netlify/functions/community-alerts.js`, `netlify/functions/cleanup.js`, `supabase/schema.sql`, `supabase/rls.sql`, `supabase/triggers.sql`, `web/src/App.tsx`, `web/src/style.css`, `messcomunication.md`, `iPhone Mesh Communication Research.md`, `Off-Grid Mesh Messaging_ Open-Source Projects & Technologies.md`, `Offline Communication App Research.md`.
